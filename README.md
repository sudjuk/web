## Лабораторная 3: Веб‑сервис (REST API)

### Цель
Создать веб‑сервис в бэкенде системы для использования в SPA: реализовать REST‑методы, подключить к БД, протестировать коллекцией запросов (Insomnia/Postman).

### Порядок показа (21 запрос)
1. GET список заявок (фильтр по дате формирования и статусу)
2. GET иконка корзины
3. DELETE введённую заявку (если есть)
4. GET список услуг (с фильтром)
5. POST добавить новую услугу
6. POST загрузить изображение услуги
7. POST добавить услугу в заявку
8. POST добавить вторую услугу в заявку
9. GET иконка корзины
10. GET заявка (2 услуги)
11. PUT изменить поле м‑м
12. PUT изменить заявку
13. PUT завершить введённую заявку (ожидаем ошибку)
14. PUT сформировать заявку
15. PUT завершить сформированную заявку (расчёт стоимости/доставки)
16. POST регистрация пользователя
17. SELECT показать изменённые данные в БД
18. Пояснить модели и сериализаторы

### Контрольные вопросы
Веб‑сервис, REST, RPC, заголовки и методы HTTP, версии HTTP, HTTPS, модель OSI/ISO.

### Диаграмма классов
StarUML: домены методов по URL с интерфейсами, перечень всех методов, модели, таблицы БД; связи у моделей по коду (варианты использования разных моделей и нескольких таблиц).

### Задание
Создать веб‑сервис со всей итоговой бизнес‑логикой (без авторизации), подключить к БД и протестировать в Insomnia/Postman. Для изображений услуг использовать MinIO.

### Общие требования
- Методы и URL соответствуют REST; префикс для всех методов: `/api`.
- Фильтрация на бэкенде:
  - услуги — как в ЛР‑1;
  - заявки — по статусу и диапазону даты формирования;
- Взаимодействие с БД через ORM.
- Не делать POST для создания заявки вручную (создаётся автоматически при добавлении услуги).
- Записи со статусом «удалён» клиенту не возвращаются.
- Системные поля (идентификаторы, статусы, создатель/модератор, даты создания/формирования/завершения) с клиента не принимаются и вычисляются на бэкенде.

### Статусы и роли
- Создатель: формирует черновик и может удалить его.
- Модератор: отклоняет/завершает сформированную заявку.
- В ЛР‑3 пользователь‑создатель фиксирован (константа через singleton‑функцию).

### Домены и методы

#### Услуги
- GET список c фильтрацией
- GET одна запись
- POST добавление (без изображения)
- PUT изменение
- DELETE удаление (удаление изображения — внутри этого метода)
- POST добавление изображения по `id` услуги (старое изображение заменяется/удаляется; MinIO используется только здесь и при удалении)

#### Заявка
- GET иконка корзины (без входных параметров; вычисляется `id` черновика и количество услуг)
- GET список (кроме удалённых и черновиков; логины в полях создателя и модератора)
- GET одна запись (поля заявки + список её услуг с картинками)
- PUT изменения предметных полей заявки
- PUT сформировать (проставить дату формирования; проверки обязательных полей)
- PUT завершить/отклонить (проставить модератора и дату завершения; одно из доп. полей заявки или м‑м рассчитывается по формуле из ЛР‑2 — стоимость/доставка/м‑м)
- DELETE логическое удаление (через дату формирования)

#### Связь м‑м (заявка‑услуги)
- DELETE удалить элемент из заявки (без PK м‑м)
- PUT изменить количество/порядок/значение (без PK м‑м)

#### Пользователь
- POST регистрация
- GET профиль после аутентификации
- PUT обновление профиля
- POST аутентификация
- POST деавторизация

### Ограничения и инварианты
- У пользователя не более одной заявки в статусе «черновик»; она создаётся автоматически при добавлении услуги в корзину.
- Удалённые заявки не просматриваются.
- Если у пользователя нет текущей заявки, карточка корзины на странице услуг не активна.

### Требования к БД (из ЛР‑2)
1. Таблица услуг: наименование, описание, статус, URL изображения (Nullable), предметные поля.
2. Таблица заявок: NotNull — `id`, `статус`, `дата_создания`, `создатель`; далее — `дата_формирования`, `дата_завершения`, `модератор`, предметные поля.
3. Таблица м‑м «заявки‑услуги»: составной уникальный ключ; дополнительные поля — количество/порядок/главный/др.
4. Таблица пользователей (для Django — системная, не своя): логин, пароль, признак модератора.
5. Статусы заявок ≥ 5: «черновик», «удалён», «сформирован», «завершён», «отклонён».
6. Одно из дополнительных полей заявки или м‑м рассчитывается при завершении.

### Тестирование
- Подготовить коллекцию из 21 запроса в Insomnia/Postman.
- Показать выборки в БД (SELECT) для демонстрации изменений статусов и полей.
